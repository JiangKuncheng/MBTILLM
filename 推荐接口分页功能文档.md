 # MBTI推荐系统 - 推荐接口分页功能文档

## 📋 概述

本系统提供了两个主要的推荐接口，支持分页浏览和内容详情获取，让前端可以灵活地展示推荐内容，提升用户体验。

## 🚀 接口列表

### 1. 用户个性化推荐接口
**接口地址：** `GET /api/v1/recommendations/{user_id}`

**功能描述：** 根据用户的MBTI特征，推荐相似度最高的内容

### 2. 相似内容推荐接口  
**接口地址：** `GET /api/v1/recommendations/similar/{content_id}`

**功能描述：** 根据指定内容的MBTI特征，推荐相似度最高的其他内容

---

## 📖 接口详细说明

### 用户个性化推荐接口

#### 请求参数

| 参数名 | 类型 | 必填 | 默认值 | 说明 |
|--------|------|------|--------|------|
| `user_id` | int | ✅ | - | 用户ID（路径参数） |
| `page` | int | ❌ | 1 | 页码，从1开始 |
| `limit` | int | ❌ | 20 | 每页数量，1-100 |
| `content_type` | string | ❌ | all | 内容类型：article/video/product/all |
| `similarity_threshold` | float | ❌ | 0.5 | 相似度阈值，0.1-0.9 |
| `exclude_viewed` | boolean | ❌ | true | 是否排除已浏览内容 |
| `fresh_days` | int | ❌ | 30 | 内容新鲜度天数 |
| `include_content_details` | boolean | ❌ | true | 是否包含内容详情 |

#### 请求示例

```bash
# 获取用户1的第一页推荐，每页10条
GET /api/v1/recommendations/1?page=1&limit=10&include_content_details=true

# 获取用户1的第二页推荐，排除已浏览内容
GET /api/v1/recommendations/1?page=2&limit=20&exclude_viewed=true

# 获取用户1的视频推荐
GET /api/v1/recommendations/1?content_type=video&page=1&limit=15
```

#### 响应格式

```json
{
  "success": true,
  "data": {
    "recommendations": [
      {
        "content_id": 12345,
        "title": "文章标题",
        "similarity_score": 0.85,
        "mbti_vector": [0.8, 0.6, 0.7, 0.9],
        "content": {
          "id": 12345,
          "title": "文章标题",
          "content": "文章内容...",
          "author": "作者名",
          "publish_time": "2024-01-01T10:00:00Z",
          "tags": ["标签1", "标签2"]
        }
      }
    ],
    "user_mbti": {
      "type": "INTJ",
      "vector": [0.8, 0.6, 0.7, 0.9]
    },
    "similarity_stats": {
      "average": 0.75,
      "maximum": 0.85,
      "minimum": 0.65
    },
    "metadata": {
      "total_candidates": 150,
      "valid_candidates": 120,
      "scored_contents": 100,
      "recommendation_count": 20,
      "scoring_pending": 5
    },
    "pagination": {
      "current_page": 1,
      "total_pages": 6,
      "total_count": 100,
      "limit": 20,
      "offset": 0,
      "has_next": true,
      "has_prev": false
    }
  },
  "message": "推荐生成成功"
}
```

#### 分页信息说明

| 字段 | 类型 | 说明 |
|------|------|------|
| `current_page` | int | 当前页码 |
| `total_pages` | int | 总页数 |
| `total_count` | int | 总推荐数量 |
| `limit` | int | 每页数量 |
| `offset` | int | 偏移量（内部使用） |
| `has_next` | boolean | 是否有下一页 |
| `has_prev` | boolean | 是否有上一页 |

---

### 相似内容推荐接口

#### 请求参数

| 参数名 | 类型 | 必填 | 默认值 | 说明 |
|--------|------|------|--------|------|
| `content_id` | int | ✅ | - | 基础内容ID（路径参数） |
| `page` | int | ❌ | 1 | 页码，从1开始 |
| `limit` | int | ❌ | 20 | 每页数量，1-100 |
| `user_id` | int | ❌ | - | 用户ID（可选，用于个性化） |
| `include_content_details` | boolean | ❌ | true | 是否包含内容详情 |

#### 请求示例

```bash
# 获取内容12345的相似推荐，第一页
GET /api/v1/recommendations/similar/12345?page=1&limit=10&include_content_details=true

# 获取内容12345的相似推荐，第二页
GET /api/v1/recommendations/similar/12345?page=2&limit=15
```

#### 响应格式

```json
{
  "success": true,
  "data": {
    "base_content_id": 12345,
    "base_mbti_vector": [0.8, 0.6, 0.7, 0.9],
    "similar_contents": [
      {
        "content_id": 67890,
        "similarity_score": 0.82,
        "mbti_distance": 0.18,
        "rank": 1,
        "content": {
          "id": 67890,
          "title": "相似文章标题",
          "content": "相似文章内容...",
          "author": "作者名",
          "publish_time": "2024-01-01T10:00:00Z"
        }
      }
    ],
    "pagination": {
      "current_page": 1,
      "total_pages": 3,
      "total_count": 45,
      "limit": 20,
      "offset": 0,
      "has_next": true,
      "has_prev": false
    }
  }
}
```

---

## 🔧 前端集成指南

### 分页导航组件

```javascript
// 分页组件示例
function Pagination({ pagination, onPageChange }) {
  const { current_page, total_pages, has_next, has_prev } = pagination;
  
  return (
    <div className="pagination">
      <button 
        disabled={!has_prev} 
        onClick={() => onPageChange(current_page - 1)}
      >
        上一页
      </button>
      
      <span>第 {current_page} 页，共 {total_pages} 页</span>
      
      <button 
        disabled={!has_next} 
        onClick={() => onPageChange(current_page + 1)}
      >
        下一页
      </button>
    </div>
  );
}
```

### 推荐列表组件

```javascript
// 推荐列表组件示例
function RecommendationList({ recommendations, pagination, onPageChange }) {
  return (
    <div className="recommendation-list">
      {/* 推荐内容列表 */}
      {recommendations.map(item => (
        <div key={item.content_id} className="recommendation-item">
          <h3>{item.title}</h3>
          <p>相似度: {item.similarity_score}</p>
          
          {/* 如果包含内容详情 */}
          {item.content && (
            <div className="content-details">
              <p>{item.content.content.substring(0, 100)}...</p>
              <p>作者: {item.content.author}</p>
              <p>发布时间: {item.content.publish_time}</p>
            </div>
          )}
        </div>
      ))}
      
      {/* 分页组件 */}
      <Pagination pagination={pagination} onPageChange={onPageChange} />
    </div>
  );
}
```

### API调用示例

```javascript
// 获取用户推荐
async function getUserRecommendations(userId, page = 1, limit = 20) {
  try {
    const response = await fetch(
      `/api/v1/recommendations/${userId}?page=${page}&limit=${limit}&include_content_details=true`
    );
    
    if (!response.ok) {
      throw new Error('获取推荐失败');
    }
    
    const data = await response.json();
    return data.data;
  } catch (error) {
    console.error('获取推荐失败:', error);
    throw error;
  }
}

// 获取相似内容推荐
async function getSimilarRecommendations(contentId, page = 1, limit = 20) {
  try {
    const response = await fetch(
      `/api/v1/recommendations/similar/${contentId}?page=${page}&limit=${limit}&include_content_details=true`
    );
    
    if (!response.ok) {
      throw new Error('获取相似推荐失败');
    }
    
    const data = await response.json();
    return data.data;
  } catch (error) {
    console.error('获取相似推荐失败:', error);
    throw error;
  }
}
```

---

## 📊 性能优化建议

### 1. 分页策略
- **合理设置每页数量**：建议20-50条，避免单次请求数据过多
- **预加载下一页**：可以在用户浏览当前页时，预加载下一页数据
- **缓存策略**：对热门用户的推荐结果进行缓存

### 2. 内容详情控制
- **按需加载**：`include_content_details=false` 时只返回基础信息，减少传输量
- **懒加载**：用户点击查看详情时再加载完整内容
- **图片优化**：内容中的图片使用懒加载和压缩

### 3. 错误处理
- **网络异常**：实现重试机制和降级策略
- **数据缺失**：当内容详情获取失败时，显示基础信息
- **用户友好**：提供清晰的错误提示和加载状态

---

## 🔍 调试和测试

### 测试用例

```bash
# 1. 基础功能测试
curl "http://localhost:8000/api/v1/recommendations/1?page=1&limit=5"

# 2. 分页功能测试
curl "http://localhost:8000/api/v1/recommendations/1?page=2&limit=5"

# 3. 内容详情测试
curl "http://localhost:8000/api/v1/recommendations/1?include_content_details=true"

# 4. 相似推荐测试
curl "http://localhost:8000/api/v1/recommendations/similar/10001?page=1&limit=10"
```

### 常见问题排查

| 问题 | 可能原因 | 解决方案 |
|------|----------|----------|
| 分页不准确 | 数据在请求过程中发生变化 | 使用时间戳或版本号确保数据一致性 |
| 内容详情为空 | Sohu API调用失败 | 检查网络连接和API配置 |
| 推荐数量不足 | 用户MBTI特征未建立 | 引导用户完成MBTI测试 |
| 响应时间过长 | 数据库查询复杂 | 优化查询语句，添加索引 |

---





---



---

*最后更新时间：2024年1月*